[gd_scene load_steps=15 format=3 uid="uid://bbob328vqlyyn"]

[ext_resource type="PackedScene" uid="uid://hv3q4g1hg5ha" path="res://assets/models/npc/npc_001.fbx" id="1_ern56"]
[ext_resource type="AnimationLibrary" uid="uid://cdlr0yiu6simk" path="res://assets/animations/All_Animations.tres" id="2_viain"]
[ext_resource type="Script" uid="uid://glr2uml18crh" path="res://scripts/animation/animation_sequencer.gd" id="3_ucf0r"]
[ext_resource type="Script" uid="uid://bat76x8xqttar" path="res://scripts/dialogue/dialogue_interactable.gd" id="4_0qma5"]
[ext_resource type="PackedScene" uid="uid://d2nw21rtn1pq6" path="res://assets/dialogue/styles/gothic_silent_hill/Balloon.tscn" id="5_xbc5e"]
[ext_resource type="Resource" uid="uid://bhcp6jljxq8pj" path="res://assets/dialogue/dialogue/test_001.dialogue" id="6_kbuqy"]
[ext_resource type="Script" uid="uid://c1eo4j34dxno3" path="res://scripts/dialogue/dialogue_settings.gd" id="7_x4fih"]
[ext_resource type="Script" uid="uid://d4mre44gaciao" path="res://scripts/dialogue/dialogue_player_settings.gd" id="8_77if5"]
[ext_resource type="Script" uid="uid://pqedudvcybfr" path="res://scripts/animation/head_look_at_controller.gd" id="9_l8eel"]

[sub_resource type="Shader" id="Shader_kaq2p"]
code = "shader_type spatial;
render_mode blend_mix, unshaded, cull_back;

uniform sampler2D screen_texture : hint_screen_texture, repeat_disable, filter_nearest;

// Mosaic controls
uniform float mosaic_pixel_size = 8.0;

void fragment() {	
	// setup the mask as something 
	//float mask = 1.0 - pow(clamp(base_col.a, 0.0, 1.0), mask_sharpness);
	
	vec2 suv = SCREEN_UV;
	
	// get pixels and quantize 
	vec2 vp = vec2(VIEWPORT_SIZE); // viewport resolution
	vec2 px_uv = suv * vp;
	vec2 q = floor(px_uv / mosaic_pixel_size) * mosaic_pixel_size + (mosaic_pixel_size * 0.5);
	vec2 mosaic_uv = q / vp;
	
	vec3 sampled_rgb = texture(screen_texture, mosaic_uv).rgb;
	
	EMISSION = sampled_rgb;
	ALBEDO = sampled_rgb;
	ALPHA = 1.0;
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ern56"]
render_priority = 0
shader = SubResource("Shader_kaq2p")
shader_parameter/mosaic_pixel_size = 5.0

[sub_resource type="Resource" id="Resource_g1xht"]
script = ExtResource("7_x4fih")
balloon_scene = ExtResource("5_xbc5e")
dialogue_resource = ExtResource("6_kbuqy")
dialogue_start = "start"
metadata/_custom_type_script = "uid://c1eo4j34dxno3"

[sub_resource type="Resource" id="Resource_umgsa"]
script = ExtResource("8_77if5")
is_repeatable = true
next_after_seconds = 5.0
metadata/_custom_type_script = "uid://d4mre44gaciao"

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_ap2pf"]
radius = 0.34088
height = 1.56803

[node name="npc" instance=ExtResource("1_ern56")]

[node name="Armature" parent="." index="0"]
transform = Transform3D(0.6, 0, 0, 0, 0.6, 4.52987e-08, 0, -4.52987e-08, 0.6, 0, 0, 0)

[node name="Skeleton3D" parent="Armature" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.58744e-08, -0.210263)
bones/0/position = Vector3(-0.00163146, 0.558586, 0.00537886)
bones/0/rotation = Quaternion(-0.0827702, -0.00832072, 0.022009, 0.996291)
bones/1/rotation = Quaternion(0.115867, -0.00724338, -0.0376178, 0.992526)
bones/2/rotation = Quaternion(0.0197305, -0.000361476, -0.00340244, 0.999799)
bones/3/rotation = Quaternion(0.0197325, -0.000392939, -0.00345247, 0.999799)
bones/4/rotation = Quaternion(0.0724703, 0.00441193, 0.000165107, 0.997361)
bones/5/rotation = Quaternion(0.0120798, 0.00442003, -0.000236052, 0.999917)
bones/8/rotation = Quaternion(0.65488, 0.353663, -0.525119, 0.41268)
bones/9/rotation = Quaternion(0.336702, -0.0430098, 0.15841, 0.927194)
bones/10/rotation = Quaternion(0.0566226, -0.00244875, 0.474779, 0.878278)
bones/11/rotation = Quaternion(-0.118111, 0.256149, 0.0151016, 0.959276)
bones/12/rotation = Quaternion(0.210917, 0.135168, 0.2399, 0.937919)
bones/13/rotation = Quaternion(0.101153, -0.00341776, -0.190556, 0.976445)
bones/14/rotation = Quaternion(-0.0127807, 0.0425219, 0.070405, 0.99653)
bones/17/rotation = Quaternion(0.448321, 0.000945777, -0.028574, 0.893415)
bones/18/rotation = Quaternion(0.282642, -0.00053757, -0.042965, 0.958263)
bones/19/rotation = Quaternion(0.11338, 0.000363435, -0.0173486, 0.9934)
bones/22/rotation = Quaternion(0.685972, -0.319902, 0.523351, 0.39142)
bones/23/rotation = Quaternion(0.29251, 0.0358027, -0.287704, 0.911253)
bones/24/rotation = Quaternion(0.0369407, 0.00272111, -0.320553, 0.946506)
bones/25/rotation = Quaternion(0.013661, -0.259413, -0.0270873, 0.96529)
bones/26/rotation = Quaternion(0.0767396, -0.132938, -0.24778, 0.956579)
bones/27/rotation = Quaternion(0.210194, -0.0692068, 0.17071, 0.96015)
bones/28/rotation = Quaternion(0.102927, 0.14273, -0.0485306, 0.983198)
bones/31/rotation = Quaternion(0.409286, -0.00358431, 0.0183087, 0.912216)
bones/32/rotation = Quaternion(0.306999, 0.000201121, 0.0336992, 0.951113)
bones/33/rotation = Quaternion(0.157672, -0.000350497, 0.0156967, 0.987367)
bones/36/rotation = Quaternion(0.0804242, 0.649284, 0.752234, -0.0781472)
bones/37/rotation = Quaternion(-0.7019, 0.0243568, -0.0864422, 0.706591)
bones/38/rotation = Quaternion(0.448715, 0.0187314, 0.0721248, 0.890563)
bones/39/rotation = Quaternion(0.290116, -0.0565116, 0.0171644, 0.955167)
bones/42/rotation = Quaternion(-0.0469809, 0.663031, 0.745006, 0.0561082)
bones/43/rotation = Quaternion(-0.7229, 0.0709624, -0.0396043, 0.686157)
bones/44/rotation = Quaternion(0.474935, -0.010743, -0.0930785, 0.875019)
bones/45/rotation = Quaternion(0.289491, 0.0574358, -0.0173331, 0.955299)

[node name="BoneAttachment3D" type="BoneAttachment3D" parent="Armature/Skeleton3D" index="1"]
transform = Transform3D(0.999158, 0.0322856, -0.0253111, -0.0385559, 0.949795, -0.310487, 0.0140161, 0.311202, 0.95024, 0.0197263, 1.62158, 0.118234)
bone_name = "mixamorig1_Head"
bone_idx = 5

[node name="CensoredBlur" type="CSGBox3D" parent="Armature/Skeleton3D/BoneAttachment3D" index="0"]
transform = Transform3D(1.00003, -5.04777e-07, 2.76603e-07, -2.79397e-07, 1, -1.72853e-06, -1.81608e-07, 2.98023e-08, 1, 0.0135806, 0.151993, 0.0100708)
size = Vector3(0.343689, 0.576324, 0.439331)
material = SubResource("ShaderMaterial_ern56")

[node name="AnimationPlayer" type="AnimationPlayer" parent="Armature" index="1"]
libraries = {
&"All_Animations": ExtResource("2_viain")
}
script = ExtResource("3_ucf0r")
play_on_ready = true
loop_sequence = true
sequence = Array[String](["All_Animations/SittingWaiting"])

[node name="DialogueInteractable" type="Area3D" parent="." index="1"]
script = ExtResource("4_0qma5")
dialogue_settings = SubResource("Resource_g1xht")
player_settings = SubResource("Resource_umgsa")
metadata/_custom_type_script = "uid://bat76x8xqttar"

[node name="CollisionShape3D" type="CollisionShape3D" parent="DialogueInteractable" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0241189, 0.552854, -0.0852549)
shape = SubResource("CapsuleShape3D_ap2pf")

[node name="HeadLookAtController" type="Node3D" parent="." index="2" node_paths=PackedStringArray("skeleton", "interactable")]
script = ExtResource("9_l8eel")
skeleton = NodePath("../Armature/Skeleton3D")
interactable = NodePath("../DialogueInteractable")
follow_seconds = 10.0
metadata/_custom_type_script = "uid://pqedudvcybfr"
