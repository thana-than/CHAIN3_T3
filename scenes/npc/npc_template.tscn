[gd_scene load_steps=15 format=3 uid="uid://7tlfpxa2shl7"]

[ext_resource type="PackedScene" uid="uid://hv3q4g1hg5ha" path="res://assets/models/npc/npc_001.fbx" id="1_0kia1"]
[ext_resource type="AnimationLibrary" uid="uid://cdlr0yiu6simk" path="res://assets/animations/All_Animations.tres" id="2_pa1xa"]
[ext_resource type="Script" uid="uid://glr2uml18crh" path="res://scripts/animation/animation_sequencer.gd" id="3_e1hom"]
[ext_resource type="Script" uid="uid://bat76x8xqttar" path="res://scripts/dialogue/dialogue_interactable.gd" id="4_ghy3t"]
[ext_resource type="PackedScene" uid="uid://d2nw21rtn1pq6" path="res://assets/dialogue/styles/gothic_silent_hill/Balloon.tscn" id="5_klx6h"]
[ext_resource type="Resource" uid="uid://bhcp6jljxq8pj" path="res://assets/dialogue/dialogue/test_001.dialogue" id="6_wgtpr"]
[ext_resource type="Script" uid="uid://c1eo4j34dxno3" path="res://scripts/dialogue/dialogue_settings.gd" id="7_hkold"]
[ext_resource type="Script" uid="uid://d4mre44gaciao" path="res://scripts/dialogue/dialogue_player_settings.gd" id="8_7ipbf"]
[ext_resource type="Script" uid="uid://pqedudvcybfr" path="res://scripts/animation/head_look_at_controller.gd" id="9_6ip2i"]

[sub_resource type="Shader" id="Shader_kaq2p"]
code = "shader_type spatial;
render_mode blend_mix, unshaded, cull_back;

uniform sampler2D screen_texture : hint_screen_texture, repeat_disable, filter_nearest;

// Mosaic controls
uniform float mosaic_pixel_size = 8.0;

void fragment() {	
	// setup the mask as something 
	//float mask = 1.0 - pow(clamp(base_col.a, 0.0, 1.0), mask_sharpness);
	
	vec2 suv = SCREEN_UV;
	
	// get pixels and quantize 
	vec2 vp = vec2(VIEWPORT_SIZE); // viewport resolution
	vec2 px_uv = suv * vp;
	vec2 q = floor(px_uv / mosaic_pixel_size) * mosaic_pixel_size + (mosaic_pixel_size * 0.5);
	vec2 mosaic_uv = q / vp;
	
	vec3 sampled_rgb = texture(screen_texture, mosaic_uv).rgb;
	
	EMISSION = sampled_rgb;
	ALBEDO = sampled_rgb;
	ALPHA = 1.0;
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0kia1"]
render_priority = 0
shader = SubResource("Shader_kaq2p")
shader_parameter/mosaic_pixel_size = 5.0

[sub_resource type="Resource" id="Resource_g1xht"]
script = ExtResource("7_hkold")
balloon_scene = ExtResource("5_klx6h")
dialogue_resource = ExtResource("6_wgtpr")
dialogue_start = "start"
metadata/_custom_type_script = "uid://c1eo4j34dxno3"

[sub_resource type="Resource" id="Resource_umgsa"]
script = ExtResource("8_7ipbf")
is_repeatable = true
next_after_seconds = 5.0
metadata/_custom_type_script = "uid://d4mre44gaciao"

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_ap2pf"]
radius = 0.34088
height = 1.56803

[node name="npc" instance=ExtResource("1_0kia1")]

[node name="Armature" parent="." index="0"]
transform = Transform3D(0.6, 0, 0, 0, 0.6, 4.52987e-08, 0, -4.52987e-08, 0.6, 0, 0, 0)

[node name="Skeleton3D" parent="Armature" index="0"]
bones/0/position = Vector3(0.00421546, 0.603128, -0.245448)
bones/0/rotation = Quaternion(-0.24778, -0.0192418, -0.0164151, 0.968486)
bones/1/rotation = Quaternion(0.236505, -0.0048279, 0.0140818, 0.971516)
bones/2/rotation = Quaternion(0.0190987, -0.00282075, 0.00894405, 0.999774)
bones/3/rotation = Quaternion(0.0191154, -0.00231993, 0.00906979, 0.999774)
bones/4/rotation = Quaternion(0.175756, 0.00673799, -0.0194949, 0.984218)
bones/5/rotation = Quaternion(0.115993, 0.00554828, -0.0198664, 0.993036)
bones/8/rotation = Quaternion(0.53361, 0.436562, -0.620409, 0.373854)
bones/9/rotation = Quaternion(0.373616, 0.33554, 0.105429, 0.858318)
bones/10/rotation = Quaternion(0.0759411, -0.00213934, 0.636765, 0.767306)
bones/11/rotation = Quaternion(-0.257294, 0.20195, 0.0405989, 0.944123)
bones/12/rotation = Quaternion(0.293011, 0.142145, 0.23036, 0.916992)
bones/13/rotation = Quaternion(-0.0115623, -0.00825244, -0.0815803, 0.996566)
bones/14/rotation = Quaternion(-0.0307575, 0.000441394, 0.0401306, 0.998721)
bones/17/rotation = Quaternion(2.4775e-05, 0.000191964, 0.0430899, 0.999071)
bones/18/rotation = Quaternion(0.0199104, 9.86648e-05, -0.00768532, 0.999772)
bones/19/rotation = Quaternion(0.00995605, -6.23508e-05, -0.00344166, 0.999945)
bones/22/rotation = Quaternion(0.5797, -0.416896, 0.573255, 0.4019)
bones/23/rotation = Quaternion(0.454646, -0.188957, 0.0364219, 0.869635)
bones/24/rotation = Quaternion(0.0782978, 0.00209739, -0.679426, 0.729551)
bones/25/rotation = Quaternion(-0.166748, -0.312079, -0.0170695, 0.935153)
bones/26/rotation = Quaternion(0.290706, -0.161159, -0.217013, 0.917836)
bones/27/rotation = Quaternion(0.133159, -0.0811807, 0.114752, 0.981076)
bones/28/rotation = Quaternion(0.0422319, -0.0354087, -0.0455696, 0.99744)
bones/31/rotation = Quaternion(0.0186608, -0.000486996, -0.0357932, 0.999185)
bones/32/rotation = Quaternion(0.01719, -1.86325e-05, 0.00548489, 0.999837)
bones/33/rotation = Quaternion(0.00859525, -2.25459e-05, 0.00110047, 0.999962)
bones/36/rotation = Quaternion(0.0527849, 0.489278, 0.869824, -0.0350295)
bones/37/rotation = Quaternion(-0.73172, 0.0277931, 0.0218468, 0.680688)
bones/38/rotation = Quaternion(0.480213, 0.0104277, 0.0565148, 0.875267)
bones/39/rotation = Quaternion(0.335172, -0.0710361, 0.0141973, 0.939368)
bones/42/rotation = Quaternion(-0.123888, 0.476209, 0.869154, 0.0494876)
bones/43/rotation = Quaternion(-0.740824, -0.0150164, -0.0127491, 0.671411)
bones/44/rotation = Quaternion(0.525391, -0.0392107, -0.111322, 0.842635)
bones/45/rotation = Quaternion(0.313146, 0.0647094, -0.0157645, 0.947367)

[node name="BoneAttachment3D" type="BoneAttachment3D" parent="Armature/Skeleton3D" index="1"]
transform = Transform3D(0.999766, 0.0123838, -0.0176913, -0.0204879, 0.802866, -0.595807, 0.00682543, 0.596031, 0.802932, -0.0127576, 1.64246, -0.241455)
bone_name = "mixamorig1_Head"
bone_idx = 5

[node name="CensoredBlur" type="CSGBox3D" parent="Armature/Skeleton3D/BoneAttachment3D" index="0"]
transform = Transform3D(1.00003, -5.04777e-07, 2.76603e-07, -2.79397e-07, 1, -1.72853e-06, -1.81608e-07, 2.98023e-08, 1, 0.0135806, 0.151993, 0.0100708)
size = Vector3(0.343689, 0.576324, 0.439331)
material = SubResource("ShaderMaterial_0kia1")

[node name="AnimationPlayer" type="AnimationPlayer" parent="Armature" index="1"]
libraries = {
&"All_Animations": ExtResource("2_pa1xa")
}
script = ExtResource("3_e1hom")
play_on_ready = true
loop_sequence = true
sequence = Array[String](["All_Animations/SittingAntsy"])

[node name="DialogueInteractable" type="Area3D" parent="." index="1"]
script = ExtResource("4_ghy3t")
dialogue_settings = SubResource("Resource_g1xht")
player_settings = SubResource("Resource_umgsa")
metadata/_custom_type_script = "uid://bat76x8xqttar"

[node name="CollisionShape3D" type="CollisionShape3D" parent="DialogueInteractable" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0241189, 0.552854, -0.0852549)
shape = SubResource("CapsuleShape3D_ap2pf")

[node name="HeadLookAtController" type="Node3D" parent="." index="2" node_paths=PackedStringArray("skeleton", "interactable")]
script = ExtResource("9_6ip2i")
skeleton = NodePath("../Armature/Skeleton3D")
interactable = NodePath("../DialogueInteractable")
follow_seconds = 10.0
metadata/_custom_type_script = "uid://pqedudvcybfr"
